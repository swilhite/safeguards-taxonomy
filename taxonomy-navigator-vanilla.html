<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Safeguards Reporting Taxonomy Navigator</title>
    <style>
        * {
            margin: 0;
            padding: 0;
            box-sizing: border-box;
        }
        
        body {
            font-family: -apple-system, BlinkMacSystemFont, 'Segoe UI', Roboto, 'Helvetica Neue', Arial, sans-serif;
            line-height: 1.5;
            color: #111827;
        }
        
        #app {
            width: 100%;
            height: 100vh;
            display: flex;
            flex-direction: column;
            background: white;
        }
        
        .header {
            border-bottom: 1px solid #e5e7eb;
            background: #f9fafb;
            padding: 1rem;
        }
        
        .header-top {
            display: flex;
            align-items: center;
            justify-content: space-between;
            margin-bottom: 0.75rem;
        }
        
        .header-title h1 {
            font-size: 1.25rem;
            font-weight: 700;
            color: #111827;
        }
        
        .header-title p {
            font-size: 0.875rem;
            color: #4b5563;
        }
        
        .view-buttons {
            display: flex;
            gap: 0.5rem;
        }
        
        .view-btn {
            padding: 0.25rem 0.75rem;
            font-size: 0.875rem;
            border-radius: 0.25rem;
            cursor: pointer;
            border: 1px solid #d1d5db;
            background: white;
            color: #374151;
        }
        
        .view-btn.active {
            background: #3b82f6;
            color: white;
            border-color: #3b82f6;
        }
        
        .search-container {
            position: relative;
        }
        
        .search-icon {
            position: absolute;
            left: 0.75rem;
            top: 0.625rem;
            width: 1rem;
            height: 1rem;
            color: #9ca3af;
        }
        
        .search-input {
            width: 100%;
            padding: 0.5rem 1rem 0.5rem 2.5rem;
            border: 1px solid #d1d5db;
            border-radius: 0.5rem;
            font-size: 0.875rem;
        }
        
        .search-input:focus {
            outline: none;
            border-color: #3b82f6;
            box-shadow: 0 0 0 3px rgba(59, 130, 246, 0.1);
        }
        
        .search-results-count {
            position: absolute;
            right: 0.75rem;
            top: 0.625rem;
            font-size: 0.75rem;
            color: #6b7280;
            background: white;
            padding: 0 0.25rem;
        }
        
        .main-content {
            display: flex;
            flex: 1;
            overflow: hidden;
        }
        
        .tree-panel {
            width: 50%;
            border-right: 1px solid #e5e7eb;
            overflow-y: auto;
        }
        
        .detail-panel {
            width: 50%;
            background: #f9fafb;
            overflow-y: auto;
            padding: 1.5rem;
        }
        
        .tree-node {
            cursor: pointer;
            padding: 0.5rem 0.75rem;
            display: flex;
            align-items: start;
        }
        
        .tree-node:hover {
            background: #eff6ff;
        }
        
        .tree-node.selected {
            background: #dbeafe;
            border-left: 4px solid #3b82f6;
        }
        
        .tree-node.highlight {
            background: #fefce8;
        }
        
        .node-content {
            display: flex;
            align-items: center;
            min-width: 0;
            flex: 1;
        }
        
        .chevron {
            width: 1.5rem;
            margin-right: 0.5rem;
            flex-shrink: 0;
            color: #6b7280;
        }
        
        .chevron svg {
            width: 1rem;
            height: 1rem;
        }
        
        .node-info {
            min-width: 0;
            flex: 1;
        }
        
        .node-label {
            font-weight: 500;
            color: #111827;
        }
        
        .node-id {
            font-size: 0.75rem;
            color: #6b7280;
            font-family: monospace;
            white-space: nowrap;
            overflow: hidden;
            text-overflow: ellipsis;
        }
        
        .sensitivity-badge {
            margin-left: 0.5rem;
            padding: 0.125rem 0.5rem;
            font-size: 0.75rem;
            border-radius: 9999px;
            flex-shrink: 0;
        }
        
        .sensitivity-low {
            background: #f0fdf4;
            color: #16a34a;
        }
        
        .sensitivity-medium {
            background: #fefce8;
            color: #ca8a04;
        }
        
        .sensitivity-high {
            background: #fef2f2;
            color: #dc2626;
        }
        
        .detail-header {
            margin-bottom: 1rem;
        }
        
        .detail-title {
            display: flex;
            align-items: start;
            justify-content: space-between;
            margin-bottom: 0.5rem;
        }
        
        .detail-title h2 {
            font-size: 1.5rem;
            font-weight: 700;
            color: #111827;
        }
        
        .detail-id {
            font-size: 0.875rem;
            color: #6b7280;
            font-family: monospace;
        }
        
        .detail-section {
            margin-bottom: 1.5rem;
        }
        
        .section-title {
            font-size: 0.875rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
            display: flex;
            align-items: center;
        }
        
        .section-title svg {
            width: 1rem;
            height: 1rem;
            margin-right: 0.5rem;
        }
        
        .section-content {
            color: #1f2937;
        }
        
        .example-list {
            list-style-type: disc;
            list-style-position: inside;
        }
        
        .example-list li {
            color: #374151;
            font-size: 0.875rem;
            margin-bottom: 0.25rem;
        }
        
        .tag-list {
            display: flex;
            flex-wrap: wrap;
            gap: 0.5rem;
        }
        
        .tag {
            padding: 0.25rem 0.5rem;
            background: #f3f4f6;
            color: #374151;
            font-size: 0.75rem;
            border-radius: 0.25rem;
        }
        
        .related-node, .child-node {
            display: block;
            width: 100%;
            text-align: left;
            padding: 0.5rem;
            background: #f9fafb;
            border: 1px solid #e5e7eb;
            border-radius: 0.25rem;
            margin-bottom: 0.5rem;
            cursor: pointer;
        }
        
        .related-node:hover, .child-node:hover {
            background: #eff6ff;
        }
        
        .related-node-label, .child-node-label {
            font-weight: 500;
            font-size: 0.875rem;
            color: #2563eb;
        }
        
        .related-node-id, .child-node-id {
            font-size: 0.75rem;
            color: #6b7280;
        }
        
        .empty-state {
            display: flex;
            align-items: center;
            justify-content: center;
            height: 100%;
            color: #9ca3af;
            text-align: center;
        }
        
        .empty-state svg {
            width: 3rem;
            height: 3rem;
            margin: 0 auto 0.5rem;
            opacity: 0.5;
        }
        
        .list-item {
            padding: 0.75rem;
            cursor: pointer;
            border-bottom: 1px solid #e5e7eb;
        }
        
        .list-item:hover {
            background: #eff6ff;
        }
        
        .list-item.selected {
            background: #dbeafe;
        }
        
        .list-item-header {
            display: flex;
            align-items: start;
            justify-content: space-between;
        }
        
        .list-item-content {
            flex: 1;
            min-width: 0;
        }
        
        .list-item-label {
            font-weight: 500;
            color: #111827;
        }
        
        .list-item-definition {
            font-size: 0.875rem;
            color: #4b5563;
            margin-top: 0.25rem;
            display: -webkit-box;
            -webkit-line-clamp: 2;
            -webkit-box-orient: vertical;
            overflow: hidden;
        }
        
        .hidden {
            display: none;
        }
    </style>
</head>
<body>
    <div id="app">
        <div class="header">
            <div class="header-top">
                <div class="header-title">
                    <h1>Safeguards Reporting & Declarations Taxonomy</h1>
                    <p>Version 1.0.0</p>
                </div>
                <div class="view-buttons">
                    <button class="view-btn active" data-view="tree">Tree View</button>
                    <button class="view-btn" data-view="flat">List View</button>
                </div>
            </div>
            <div class="search-container">
                <svg class="search-icon" fill="none" viewBox="0 0 24 24" stroke="currentColor">
                    <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M21 21l-6-6m2-5a7 7 0 11-14 0 7 7 0 0114 0z" />
                </svg>
                <input type="text" class="search-input" placeholder="Search taxonomy (labels, definitions, tags, IDs)..." id="searchInput">
                <span class="search-results-count" id="searchResultsCount"></span>
            </div>
        </div>
        <div class="main-content">
            <div class="tree-panel" id="treePanel"></div>
            <div class="detail-panel" id="detailPanel">
                <div class="empty-state">
                    <div>
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p>Select a node to view details</p>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <script>
        // Taxonomy data
        const taxonomyData = {"taxonomy_id":"safrep","version":"1.0.0","title":"Safeguards Reporting & Declarations Taxonomy","root":{"id":"safrep.root","label":"Safeguards reporting domain","definition":"Taxonomy for organizing safeguards-relevant reporting, declarations, exchanges, and QA workflows.","sensitivity_level":"Low","examples":["Tag an AP declaration package","Tag a clarification response bundle"],"tags":["safeguards","reporting","declaration","information-management"],"stakeholders":"SRA/SSAC, IAEA liaison, policy analysts, data engineers","related_nodes":[],"children":[{"id":"safrep.instrument","label":"Reporting instruments","definition":"Types of submissions and exchanges used in safeguards-related reporting.","sensitivity_level":"Low","examples":["CSA accounting report","AP Article 2 declaration"],"tags":["document-type","submission"],"stakeholders":"Reporting staff, analysts, records managers","related_nodes":[],"children":[{"id":"safrep.instrument.csa","label":"CSA instruments","definition":"Reports and information typically exchanged under CSA frameworks.","sensitivity_level":"Low","examples":["Accounting report package","Design information update"],"tags":["csa","infcirc153"],"stakeholders":"SSAC/SRA, operators, safeguards analysts","related_nodes":["safrep.framework.csa-infcirc153"],"children":[{"id":"safrep.instrument.csa.accounting-report","label":"Accounting report","definition":"Structured submission of declared accounting information for safeguards purposes.","sensitivity_level":"Medium","examples":["Inventory change submission","Material balance reporting package"],"tags":["accounting","nma","inventory"],"stakeholders":"SSAC accountants, facility safeguards officers","related_nodes":["safrep.qa.data-quality","safrep.actor.operator"],"children":[]},{"id":"safrep.instrument.csa.design-info","label":"Design information","definition":"High-level facility/LOF design information and updates for safeguards planning.","sensitivity_level":"Medium","examples":["Design information update letter","DIQ-related submission"],"tags":["design-information","diq"],"stakeholders":"Operators, SRA, safeguards information analysts","related_nodes":["safrep.content.locations"],"children":[]},{"id":"safrep.instrument.csa.special-report","label":"Special report","definition":"Non-routine report addressing unusual circumstances relevant to safeguards.","sensitivity_level":"Medium","examples":["Exceptional status update","Notification of unusual record-impacting event"],"tags":["special-report","notification"],"stakeholders":"SRA focal point, safeguards leads","related_nodes":["safrep.process.resolve"],"children":[]}]},{"id":"safrep.instrument.ap","label":"AP declarations","definition":"Declarations and updates associated with Additional Protocol frameworks.","sensitivity_level":"Low","examples":["Annual AP submission","Corrected AP update"],"tags":["additional-protocol","infcirc540"],"stakeholders":"AP coordinator, legal/policy units, analysts","related_nodes":["safrep.framework.ap-infcirc540"],"children":[{"id":"safrep.instrument.ap.article2","label":"Article 2 declaration","definition":"Declared information categories provided under AP Article 2 (high level).","sensitivity_level":"Low","examples":["General R&D location declaration","Site/building description summary"],"tags":["ap-article2","declaration-type"],"stakeholders":"AP national coordinator, safeguards analysts","related_nodes":["safrep.content.rnd-general","safrep.content.locations.site-buildings"],"children":[]},{"id":"safrep.instrument.ap.article3","label":"Timing and updates","definition":"Timing rules and update patterns for submitting AP information.","sensitivity_level":"Low","examples":["Due-date calendar management","Annual cycle tracking"],"tags":["due-dates","updates"],"stakeholders":"SRA secretariat, program managers","related_nodes":["safrep.process.submit"],"children":[]},{"id":"safrep.instrument.ap.complementary-access-info","label":"CA support info","definition":"Administrative information supporting AP-related access coordination.","sensitivity_level":"Medium","examples":["Contact lists","Managed-access notes (high level)"],"tags":["complementary-access","coordination"],"stakeholders":"Access coordinators, legal counsel","related_nodes":["safrep.process.collect"],"children":[]}]},{"id":"safrep.instrument.exchange","label":"Supporting exchanges","definition":"Non-core exchanges enabling processing, interpretation, and auditability.","sensitivity_level":"Low","examples":["Transmittal cover letter","Submission change log"],"tags":["metadata","audit-trail"],"stakeholders":"Records managers, data engineers","related_nodes":[],"children":[{"id":"safrep.instrument.amplification","label":"Amplification","definition":"Clarifications or expansions of previously provided information.","sensitivity_level":"Low","examples":["Clarify an entity name","Resolve an inconsistency statement"],"tags":["clarification","amplification"],"stakeholders":"SRA focal point, analysts","related_nodes":["safrep.qa.consistency-checks","safrep.process.resolve"],"children":[]}]}]},{"id":"safrep.content","label":"Content categories","definition":"Topic lenses for classifying the subject matter of submissions.","sensitivity_level":"Low","examples":["Tag by sites/buildings","Tag by transfers/notifications"],"tags":["topic","classification"],"stakeholders":"Analysts, OSINT, data engineering","related_nodes":[],"children":[{"id":"safrep.content.locations","label":"Locations and sites","definition":"High-level information about sites, facilities, and relevant locations.","sensitivity_level":"Medium","examples":["Site list summary","LOF listing (high level)"],"tags":["site","facility","lof"],"stakeholders":"SRA, operators, analysts","related_nodes":["safrep.instrument.csa.design-info"],"children":[{"id":"safrep.content.locations.site-buildings","label":"Site buildings","definition":"General building/use descriptions and site-level structure summaries.","sensitivity_level":"Medium","examples":["Laboratory building noted","Administrative building listing"],"tags":["buildings","site-description"],"stakeholders":"AP coordinator, records staff","related_nodes":["safrep.instrument.ap.article2"],"children":[]}]},{"id":"safrep.content.material-accountancy","label":"Material accountancy","definition":"Reporting-focused concepts describing declared accountancy information.","sensitivity_level":"Medium","examples":["Reference to material balance period","SRD context note"],"tags":["mba","mbp","muf","srd"],"stakeholders":"SSAC, safeguards analysts","related_nodes":["safrep.instrument.csa.accounting-report"],"children":[{"id":"safrep.content.material-accountancy.mbe","label":"MBE","definition":"High-level analytical review of declared balances for anomalies and trends.","sensitivity_level":"Medium","examples":["Trend review note","Anomaly triage summary"],"tags":["mbe","balance-review"],"stakeholders":"Safeguards analysts, auditors","related_nodes":["safrep.output.risk-screen"],"children":[]}]},{"id":"safrep.content.trade-notifications","label":"Transfers","definition":"Declared transfers/notifications and related administrative information.","sensitivity_level":"Medium","examples":["Import confirmation note","Export notification metadata"],"tags":["transfer","import","export"],"stakeholders":"Compliance officers, customs liaison","related_nodes":[],"children":[]},{"id":"safrep.content.rnd-general","label":"General R&D","definition":"High-level declarations of relevant R&D activities without technical detail.","sensitivity_level":"Medium","examples":["University collaboration (general)","Funded research location list"],"tags":["rnd","declaration"],"stakeholders":"AP coordinator, research administrators","related_nodes":[],"children":[]},{"id":"safrep.content.plans-general","label":"General plans","definition":"High-level forward-looking plans captured as non-technical summaries.","sensitivity_level":"Medium","examples":["Program expansion statement","Planning memo tag"],"tags":["plans","program"],"stakeholders":"Policy planners, AP coordinator","related_nodes":[],"children":[]}]},{"id":"safrep.actor","label":"Actors","definition":"Roles that create, submit, validate, receive, and use safeguards information.","sensitivity_level":"Low","examples":["Tag as operator-provided","Assign workflow ownership"],"tags":["roles","governance"],"stakeholders":"All participants","related_nodes":[],"children":[{"id":"safrep.actor.sra","label":"SRA/SSAC","definition":"State or regional authority coordinating safeguards reporting and liaison.","sensitivity_level":"Low","examples":["AP coordination office","SSAC administration unit"],"tags":["sra","ssac"],"stakeholders":"Government focal points","related_nodes":["safrep.process.submit"],"children":[]},{"id":"safrep.actor.operator","label":"Operator","definition":"Facility/LOF operator producing records and reporting inputs.","sensitivity_level":"Low","examples":["Facility safeguards officer input","Operator declaration draft"],"tags":["operator","facility"],"stakeholders":"Operators, regulators","related_nodes":["safrep.process.collect"],"children":[]},{"id":"safrep.actor.iaea-interface","label":"IAEA interface","definition":"Administrative interfaces for communication and issue resolution.","sensitivity_level":"Low","examples":["Official mailbox process","Designated contact points"],"tags":["communication","interface"],"stakeholders":"SRA liaison, records managers","related_nodes":["safrep.process.resolve"],"children":[]},{"id":"safrep.actor.osint-analyst","label":"OSINT users","definition":"Users of public information for contextualization and corroboration.","sensitivity_level":"Low","examples":["Media report tagging","Public record cross-reference"],"tags":["osint","public-sources"],"stakeholders":"OSINT teams, civil society","related_nodes":["safrep.output.summary"],"children":[]}]},{"id":"safrep.process","label":"Processes","definition":"Lifecycle from intake through submission, correction, and archival.","sensitivity_level":"Low","examples":["Annual AP cycle","Quarterly reporting governance"],"tags":["workflow","lifecycle"],"stakeholders":"Program managers, data engineers","related_nodes":[],"children":[{"id":"safrep.process.collect","label":"Collect","definition":"Gather information from operators/sources into State systems.","sensitivity_level":"Low","examples":["Intake checklist","Document registration"],"tags":["intake","collection"],"stakeholders":"SRA information managers","related_nodes":["safrep.standard.identifiers"],"children":[]},{"id":"safrep.process.validate","label":"Validate","definition":"Administrative and content QA prior to submission.","sensitivity_level":"Low","examples":["Cross-field checks","Internal approvals"],"tags":["validation","review"],"stakeholders":"QA leads, legal reviewers","related_nodes":["safrep.qa.data-quality"],"children":[]},{"id":"safrep.process.submit","label":"Submit","definition":"Controlled submission process with logging and metadata.","sensitivity_level":"Low","examples":["Transmittal cover note","Receipt record"],"tags":["submission","audit"],"stakeholders":"SRA liaison","related_nodes":["safrep.qa.traceability"],"children":[]},{"id":"safrep.process.resolve","label":"Resolve","definition":"Consultative resolution of inconsistencies, questions, and updates.","sensitivity_level":"Low","examples":["Clarification response","Corrected declaration"],"tags":["resolution","correction"],"stakeholders":"Analysts, SRA focal points","related_nodes":["safrep.instrument.amplification"],"children":[]}]},{"id":"safrep.qa","label":"Data quality","definition":"Controls ensuring completeness, consistency, traceability, and safe handling.","sensitivity_level":"Low","examples":["Duplicate detection","Required-field enforcement"],"tags":["qa","control"],"stakeholders":"Data engineers, auditors","related_nodes":[],"children":[{"id":"safrep.qa.completeness","label":"Completeness","definition":"Ensures expected fields/documents exist for a reporting cycle.","sensitivity_level":"Low","examples":["Missing attachment alert","Overdue declaration flag"],"tags":["completeness"],"stakeholders":"QA team","related_nodes":[],"children":[]},{"id":"safrep.qa.consistency-checks","label":"Consistency","definition":"Cross-document coherence checks without technical inference.","sensitivity_level":"Low","examples":["Name matches prior submission","Date ranges align"],"tags":["consistency","cross-check"],"stakeholders":"QA + analysts","related_nodes":[],"children":[]},{"id":"safrep.qa.traceability","label":"Traceability","definition":"Links submissions to sources, approvals, and revision history.","sensitivity_level":"Low","examples":["Change log","Versioned attachments"],"tags":["audit-trail","provenance"],"stakeholders":"Records management","related_nodes":[],"children":[]},{"id":"safrep.qa.confidentiality","label":"Confidentiality","definition":"Administrative handling controls for sensitive safeguards information.","sensitivity_level":"Medium","examples":["Role-based access","Redacted public summary workflow"],"tags":["confidentiality","access-control"],"stakeholders":"Security/records officers","related_nodes":[],"children":[]},{"id":"safrep.qa.data-quality","label":"Data quality controls","definition":"Umbrella node for operationalizing checks, exceptions, and remediation.","sensitivity_level":"Low","examples":["QA checklist","Exception queue triage"],"tags":["data-quality","qa"],"stakeholders":"QA leads, data engineering","related_nodes":["safrep.qa.completeness","safrep.qa.consistency-checks"],"children":[]}]},{"id":"safrep.standard","label":"Standards","definition":"Normalized fields, identifiers, and formats enabling machine processing.","sensitivity_level":"Low","examples":["Controlled vocabulary for doc types","Standardized entity naming"],"tags":["schema","interoperability"],"stakeholders":"Data engineers, system owners","related_nodes":[],"children":[{"id":"safrep.standard.identifiers","label":"Identifiers","definition":"Controlled identifiers for submissions, locations, organizations, documents.","sensitivity_level":"Low","examples":["Submission ID","Internal registry number"],"tags":["id","registry"],"stakeholders":"Data stewards","related_nodes":[],"children":[]},{"id":"safrep.standard.format","label":"Formats","definition":"Structured templates and exchange conventions enabling ingestion.","sensitivity_level":"Low","examples":["Delimited file template","Structured submission form"],"tags":["format","template"],"stakeholders":"Data engineering, reporting staff","related_nodes":[],"children":[]}]},{"id":"safrep.framework","label":"Framework mapping","definition":"Links reporting artifacts to governing instruments and mandates.","sensitivity_level":"Low","examples":["Tag as CSA-related","Tag as AP-related"],"tags":["mapping","compliance"],"stakeholders":"Legal/policy, compliance","related_nodes":[],"children":[{"id":"safrep.framework.csa-infcirc153","label":"CSA mapping","definition":"Mapping node for CSA-related obligations and reporting concepts.","sensitivity_level":"Low","examples":["CSA reporting set tag","CSA objective reference tag"],"tags":["csa","infcirc153"],"stakeholders":"Legal/policy, safeguards analysts","related_nodes":[],"children":[]},{"id":"safrep.framework.ap-infcirc540","label":"AP mapping","definition":"Mapping node for AP-related declarations and information.","sensitivity_level":"Low","examples":["AP Article 2 tag","AP update tag"],"tags":["additional-protocol","infcirc540"],"stakeholders":"AP coordinators","related_nodes":[],"children":[]},{"id":"safrep.framework.unsc1540","label":"UNSCR 1540 linkage","definition":"High-level linkage to national compliance narratives relevant to UNSCR 1540.","sensitivity_level":"Low","examples":["Legislative update summary","Outreach program summary"],"tags":["unsc1540","legislation"],"stakeholders":"National focal points, compliance","related_nodes":[],"children":[]},{"id":"safrep.framework.npt","label":"NPT linkage","definition":"High-level linkage to NPT obligations and review-cycle analysis.","sensitivity_level":"Low","examples":["NPT review conference brief tag","Treaty interpretation memo tag"],"tags":["npt","treaty"],"stakeholders":"Policy analysts","related_nodes":[],"children":[]}]},{"id":"safrep.output","label":"Outputs","definition":"Derivative products created from submissions for decision support.","sensitivity_level":"Low","examples":["Internal dashboard","Trend summary memo"],"tags":["analytics","summary"],"stakeholders":"Leadership, analysts","related_nodes":[],"children":[{"id":"safrep.output.summary","label":"Non-sensitive summaries","definition":"Public-safe or internal high-level summaries avoiding operational specifics.","sensitivity_level":"Low","examples":["Executive brief","Issue log summary"],"tags":["summary","brief"],"stakeholders":"Policy, communications","related_nodes":[],"children":[]},{"id":"safrep.output.risk-screen","label":"Risk screening flags","definition":"Non-actionable indicators used to prioritize review.","sensitivity_level":"Medium","examples":["Missing update flag","Inconsistency pending flag"],"tags":["prioritization","triage"],"stakeholders":"Analysts, QA leads","related_nodes":["safrep.qa.consistency-checks"],"children":[]}]}]}};

        // State
        let expandedNodes = new Set(['safrep.root']);
        let selectedNode = null;
        let searchTerm = '';
        let viewMode = 'tree';
        let nodeIndex = {};

        // Build node index
        function buildNodeIndex(node) {
            nodeIndex[node.id] = node;
            if (node.children) {
                node.children.forEach(buildNodeIndex);
            }
        }
        buildNodeIndex(taxonomyData.root);

        // Search
        function matchesSearch(node, term) {
            if (!term) return true;
            const searchLower = term.toLowerCase();
            return (
                (node.label && node.label.toLowerCase().includes(searchLower)) ||
                (node.definition && node.definition.toLowerCase().includes(searchLower)) ||
                (node.tags && node.tags.some(tag => tag.toLowerCase().includes(searchLower))) ||
                (node.id && node.id.toLowerCase().includes(searchLower))
            );
        }

        // Check if node or any descendant matches search
        function nodeOrDescendantMatches(node, term) {
            if (!term) return true;
            if (matchesSearch(node, term)) return true;
            if (node.children) {
                return node.children.some(child => nodeOrDescendantMatches(child, term));
            }
            return false;
        }

        // Get sensitivity class
        function getSensitivityClass(level) {
            if (level === 'Low') return 'sensitivity-low';
            if (level === 'Medium') return 'sensitivity-medium';
            if (level === 'High') return 'sensitivity-high';
            return 'sensitivity-low';
        }

        // Render tree node
        function renderTreeNode(node, level = 0) {
            const hasChildren = node.children && node.children.length > 0;
            const isExpanded = expandedNodes.has(node.id);
            const isSelected = selectedNode && selectedNode.id === node.id;
            const matches = matchesSearch(node, searchTerm);

            // In search mode, only show nodes that match or have matching descendants
            if (searchTerm && !nodeOrDescendantMatches(node, searchTerm)) return '';

            let html = '<div class="tree-node-wrapper">';
            
            html += `<div class="tree-node ${isSelected ? 'selected' : ''} ${searchTerm && matches ? 'highlight' : ''}" 
                          data-node-id="${node.id}" 
                          style="padding-left: ${level * 24 + 12}px">`;
            html += '<div class="node-content">';
            
            // Determine if we should show children (for chevron display)
            const shouldShowChildren = hasChildren && (
                (searchTerm && nodeOrDescendantMatches(node, searchTerm)) || 
                (!searchTerm && isExpanded)
            );
            
            if (hasChildren) {
                html += `<div class="chevron" data-toggle="${node.id}">`;
                if (shouldShowChildren) {
                    html += '<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M19 9l-7 7-7-7" /></svg>';
                } else {
                    html += '<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 5l7 7-7 7" /></svg>';
                }
                html += '</div>';
            } else {
                html += '<div class="chevron"></div>';
            }
            
            html += '<div class="node-info">';
            html += `<div class="node-label">${node.label}</div>`;
            html += `<div class="node-id">${node.id}</div>`;
            html += '</div>';
            
            html += `<span class="sensitivity-badge ${getSensitivityClass(node.sensitivity_level)}">${node.sensitivity_level}</span>`;
            html += '</div></div>';
            
            if (shouldShowChildren) {
                node.children.forEach(child => {
                    html += renderTreeNode(child, level + 1);
                });
            }
            
            html += '</div>';
            return html;
        }

        // Render flat list
        function renderFlatList() {
            const nodes = Object.values(nodeIndex).filter(node => 
                !searchTerm || matchesSearch(node, searchTerm)
            );
            
            let html = '';
            nodes.forEach(node => {
                const isSelected = selectedNode && selectedNode.id === node.id;
                html += `<div class="list-item ${isSelected ? 'selected' : ''}" data-node-id="${node.id}">`;
                html += '<div class="list-item-header">';
                html += '<div class="list-item-content">';
                html += `<div class="list-item-label">${node.label}</div>`;
                html += `<div class="node-id">${node.id}</div>`;
                html += `<div class="list-item-definition">${node.definition}</div>`;
                html += '</div>';
                html += `<span class="sensitivity-badge ${getSensitivityClass(node.sensitivity_level)}">${node.sensitivity_level}</span>`;
                html += '</div></div>';
            });
            
            return html;
        }

        // Render detail panel
        function renderDetailPanel(node) {
            if (!node) {
                return `<div class="empty-state">
                    <div>
                        <svg fill="none" viewBox="0 0 24 24" stroke="currentColor">
                            <path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M13 16h-1v-4h-1m1-4h.01M21 12a9 9 0 11-18 0 9 9 0 0118 0z" />
                        </svg>
                        <p>Select a node to view details</p>
                    </div>
                </div>`;
            }

            let html = '<div class="detail-header">';
            html += '<div class="detail-title">';
            html += `<h2>${node.label}</h2>`;
            html += `<span class="sensitivity-badge ${getSensitivityClass(node.sensitivity_level)}">${node.sensitivity_level}</span>`;
            html += '</div>';
            html += `<p class="detail-id">${node.id}</p>`;
            html += '</div>';

            // Definition
            html += '<div class="detail-section">';
            html += '<div class="section-title">';
            html += '<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M9 12h6m-6 4h6m2 5H7a2 2 0 01-2-2V5a2 2 0 012-2h5.586a1 1 0 01.707.293l5.414 5.414a1 1 0 01.293.707V19a2 2 0 01-2 2z" /></svg>';
            html += 'Definition</div>';
            html += `<div class="section-content">${node.definition}</div>`;
            html += '</div>';

            // Examples
            if (node.examples && node.examples.length > 0) {
                html += '<div class="detail-section">';
                html += '<div class="section-title">Examples</div>';
                html += '<ul class="example-list">';
                node.examples.forEach(example => {
                    html += `<li>${example}</li>`;
                });
                html += '</ul></div>';
            }

            // Tags
            if (node.tags && node.tags.length > 0) {
                html += '<div class="detail-section">';
                html += '<div class="section-title">';
                html += '<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M7 7h.01M7 3h5c.512 0 1.024.195 1.414.586l7 7a2 2 0 010 2.828l-7 7a2 2 0 01-2.828 0l-7-7A1.994 1.994 0 013 12V7a4 4 0 014-4z" /></svg>';
                html += 'Tags</div>';
                html += '<div class="tag-list">';
                node.tags.forEach(tag => {
                    html += `<span class="tag">${tag}</span>`;
                });
                html += '</div></div>';
            }

            // Stakeholders
            if (node.stakeholders) {
                html += '<div class="detail-section">';
                html += '<div class="section-title">';
                html += '<svg fill="none" viewBox="0 0 24 24" stroke="currentColor"><path stroke-linecap="round" stroke-linejoin="round" stroke-width="2" d="M12 4.354a4 4 0 110 5.292M15 21H3v-1a6 6 0 0112 0v1zm0 0h6v-1a6 6 0 00-9-5.197M13 7a4 4 0 11-8 0 4 4 0 018 0z" /></svg>';
                html += 'Stakeholders</div>';
                html += `<div class="section-content">${node.stakeholders}</div>`;
                html += '</div>';
            }

            // Related nodes
            if (node.related_nodes && node.related_nodes.length > 0) {
                const relatedNodes = node.related_nodes.map(id => nodeIndex[id]).filter(Boolean);
                if (relatedNodes.length > 0) {
                    html += '<div class="detail-section">';
                    html += '<div class="section-title">Related Nodes</div>';
                    relatedNodes.forEach(relNode => {
                        html += `<button class="related-node" data-node-id="${relNode.id}">`;
                        html += `<div class="related-node-label">${relNode.label}</div>`;
                        html += `<div class="related-node-id">${relNode.id}</div>`;
                        html += '</button>';
                    });
                    html += '</div>';
                }
            }

            // Children
            if (node.children && node.children.length > 0) {
                html += '<div class="detail-section">';
                html += `<div class="section-title">Children (${node.children.length})</div>`;
                node.children.forEach(child => {
                    html += `<button class="child-node" data-node-id="${child.id}">`;
                    html += `<div class="child-node-label">${child.label}</div>`;
                    html += `<div class="child-node-id">${child.id}</div>`;
                    html += '</button>';
                });
                html += '</div>';
            }

            return html;
        }

        // Render the app
        function render() {
            const treePanel = document.getElementById('treePanel');
            const detailPanel = document.getElementById('detailPanel');
            const searchResultsCount = document.getElementById('searchResultsCount');

            if (viewMode === 'tree') {
                treePanel.innerHTML = renderTreeNode(taxonomyData.root);
            } else {
                treePanel.innerHTML = renderFlatList();
            }

            detailPanel.innerHTML = renderDetailPanel(selectedNode);

            // Update search results count
            if (searchTerm) {
                const matchCount = Object.values(nodeIndex).filter(node => 
                    matchesSearch(node, searchTerm)
                ).length;
                searchResultsCount.textContent = `${matchCount} result${matchCount !== 1 ? 's' : ''}`;
            } else {
                searchResultsCount.textContent = '';
            }

            // Attach event listeners
            attachEventListeners();
        }

        // Attach event listeners
        function attachEventListeners() {
            // Toggle nodes
            document.querySelectorAll('[data-toggle]').forEach(el => {
                el.addEventListener('click', (e) => {
                    e.stopPropagation();
                    const nodeId = el.getAttribute('data-toggle');
                    if (expandedNodes.has(nodeId)) {
                        expandedNodes.delete(nodeId);
                    } else {
                        expandedNodes.add(nodeId);
                    }
                    render();
                });
            });

            // Select nodes
            document.querySelectorAll('[data-node-id]').forEach(el => {
                el.addEventListener('click', (e) => {
                    if (!e.target.closest('[data-toggle]')) {
                        const nodeId = el.getAttribute('data-node-id');
                        selectedNode = nodeIndex[nodeId];
                        render();
                    }
                });
            });
        }

        // View mode buttons
        document.querySelectorAll('.view-btn').forEach(btn => {
            btn.addEventListener('click', () => {
                const view = btn.getAttribute('data-view');
                viewMode = view;
                
                document.querySelectorAll('.view-btn').forEach(b => b.classList.remove('active'));
                btn.classList.add('active');
                
                render();
            });
        });

        // Search input
        document.getElementById('searchInput').addEventListener('input', (e) => {
            searchTerm = e.target.value;
            render();
        });

        // Initial render
        render();
    </script>
</body>
</html>
